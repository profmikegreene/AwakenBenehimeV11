<?php
/**
 * Template Name: RCC Home Page
 *
 * This is the template that displays the RCC Home Page
 * Version: 11.0.0
 *
 * @package WordPress
 * @subpackage Awaken_Benehime
 * @since Awaken Benehime V11
 */

get_header(); ?>

<div id="primary" class="site-content">
	<div id="content" role="main">
		<div class="billboard blue30 no-hover billboard-full-width" id="billboard">
			<?php while ( have_posts() ) : the_post(); ?>
				<?php the_content(); ?>
			<?php endwhile; // end of the loop. ?>
			<?php //echo get_new_royalslider(1); ?>
		</div><!-- .billboard -->
	 	<div id="container-cubes" class="container container-cubes clearfix">
			<?php
			$args= array(
					'post_type'=>'cubes',
					'posts_per_page'  => -1,
					'meta_key' => 'cube_id',
					'orderby'  =>'meta_value_num',
					'order' => 'ASC',
			);
			$cubes_query = new WP_Query($args);
			$cubes = [];
			if ($cubes_query->have_posts()) : while($cubes_query->have_posts()) : $cubes_query->the_post();

					$id = $cubes_query->post->ID;
					$cube_id = esc_html( get_post_meta( $id,'cube_id', true ) );

					//This removes the autogenerated <p> tags that wordpress wraps
					//content with in the TinyMCE editor for the cubes on this page
					remove_filter('the_content', 'wpautop');

					$cubes[$cube_id] = [
							'cube_id' => $cube_id,
							'post_id' => $id,
							'cube_enable_url' => esc_html( get_post_meta( $id,'cube_enable_url', true ) ),
							'cube_url' => esc_html( get_post_meta( $id,'cube_url', true ) ),
							'cube_color' => esc_html( get_post_meta( $id,'cube_color', true ) ),
							'cube_class' => esc_html( get_post_meta( $id,'cube_class', true ) ),
							'cube_title' => get_the_title(),
							'cube_content' => apply_filters('the_content',get_the_content()),
							'cube_is_countdown' => esc_html( get_post_meta( $id,'cube_is_countdown', true ) ),
							'cube_countdown_date' => esc_html( get_post_meta( $id,'cube_countdown_date', true ) ),
							'has_thumbnail' => has_post_thumbnail( $id ),
							'cube_width' => esc_html( get_post_meta( $id,'cube_width', true ) ),
							'cube_height' => esc_html( get_post_meta( $id,'cube_height', true ) )
					];

					endwhile; else: ?>
					<p><?php _e('Sorry, no posts matched your criteria.'); ?></p>
			<?php endif; ?>

			<?php
				foreach ( $cubes as $cube ) {
					ab11_cubes_output( $cube );
				}
			?>
		</div><!--end .container-cubes -->
		<div id="container-highlights" class="container container-cubes clear-left clearfix">
			<div class="grid-3 highlight-title">
					<h2 class="no-margin">Recent highlights</h2>
					<p class="tagline no-margin">A look into the daily life of RCC.</p>
			</div>
			<?php
			global $switched;
      switch_to_blog(2);

			// Uncomment for production
      // switch_to_blog(25);
      //
      $args = (array(
        'showposts' => 3,
        // change category for production
				'category' => 3,
      ));
      $posts = get_posts($args);

      if($posts){
	      foreach($posts as $post){
	        setup_postdata($post);
					$thumbnail = wp_get_attachment_image_src(get_post_thumbnail_id(), 'highlight');
					$default_attr = array(
						'class'	=> "attachment",
						'alt'	=> trim(strip_tags( $post->post_title )),
						'title'	=> trim(strip_tags( $post->post_title )),
						'width' => 'auto',
						'height' => 'auto'
					);
					$image_url = wp_get_attachment_image_src( get_post_thumbnail_id($post->ID), 'highlight');
					if (has_post_thumbnail()) {
					echo '<a href="' . get_permalink() . '" class="cube rcc-blue grid-3 highlight" title="Posted '. get_the_time("j F Y | g:i a"). '">'.
							 '<img src="'.$image_url[0].'" alt="'.get_the_title().'" />'.get_the_title().'</a>';
					}
					else {
						echo '<a href="' . get_permalink() . '" class="cube grid-3 rcc-blue highlight" title="Posted '. get_the_time("j F Y | g:i a"). '">'.
							 '<img src="/wp-content/themes/css/images/default_thumb.png" alt="' . $posts[$i]->post_title . '" />'.
							 get_the_title().'</a>';
					}

	      }
      }

      restore_current_blog();
      ?>
		</div><!-- .container-highlights -->
	</div><!-- #content -->
</div><!-- #primary -->
<?php get_footer(); ?>




